<head>
<title>Matter.js Basics Tutorial</title>
<meta name="author" content="John Day">
<script src="js/lib/matter.js"></script>
<script src="js/alias.js"></script>
<script src="js/grid.js"></script>
<script src="js/lemming.js"></script>

<script src="js/index.js"></script>

</head>
<body>
  <script>

    // create an engine
    var engine = Engine.create();
    var exitArray = []

    // create a renderer
    var render = Render.create({
        element: document.body,
        engine: engine,
        options: {
          width: canvasSize.width,
          height: canvasSize.height,
          wireframes: false
      }
    });

    layerNodes = 40;
    layers = 20;
    grid = new Grid(layerNodes, layers);


    grid.generateBucket();
    grid.generateBlock(0, 7, 15, 1)
    // grid.generateBlock(15, 7, 1, 10)
    grid.entranceBlock(2, 10);
    grid.exitBlock(37, 1);

    var defaultCategory = 0x0001;
    var lemmingCategory = 0x0002;
    for (var i = 0; i < 5; i++) {
      setTimeout(function(){
        new Lemming(grid.spawn);
      }, i * 1000);
    };

    Events.on(engine, 'collisionStart', function(event){
      // console.log(event);

      for (var i = 0; i < event.pairs.length; i++) {
        var lemming = null;
        if (event.pairs[i].bodyA.label === "Circle Body"){
          lemming = event.pairs[i].bodyA;
        } else if (event.pairs[i].bodyB.label === "Circle Body"){
          lemming = event.pairs[i].bodyB;
        }
        if (lemming != null){

          if (lemming.position.x >= grid.exit.x) {
            exitArray.push(1)
            console.log(exitArray)
            World.remove(engine.world, [lemming])
            return
          }

          if (lemming.velocity.x >= 0) {
            Matter.Body.setVelocity(lemming, { x: 3, y: -1 })
          }
          else if (lemming.velocity.x < 0) {
            Matter.Body.setVelocity(lemming, { x: -3, y: -1})
          };
        };
      };
    });
    run();
  </script>
</body>
</html>
