<head>
<title>Matter.js Basics Tutorial</title>
<meta name="author" content="John Day">
<script src="js/lib/matter.js"></script>
<script src="js/alias.js"></script>
<script src="js/grid.js"></script>
<script src="js/lemming.js"></script>

<script src="js/index.js"></script>

</head>
<body>
  <script>

    // create an engine
    var engine = Engine.create();

    // create a renderer
    var render = Render.create({
        element: document.body,
        engine: engine,
        options: {
          width: canvasSize.width,
          height: canvasSize.height,
          wireframes: false
      }
    });







    //
    // Events.on(engine, 'collisionActive', function(event){
    //   if (lemming.shape.isStatic) {
    //             Matter.Body.setVelocity(lemming.shape, { x: -1, y: 1 })
    //             };
    //           });


      // Events.on(engine, 'collisionEnd', function(event){
      //   // Matter.Body.translate(lemming.shape, { x: 4, y: 0 });
      //   if (lemming.shape.velocity.x < 0) {
      //     Matter.Body.translate(lemming.shape, { x: 1, y: 0 })
      //   };
      // });



    layerNodes = 40;
    layers = 20;
    grid = new Grid(layerNodes, layers);
    grid.generateBucket();
    grid.entranceBlock(2, 10);
    grid.exitBlock(37, 1);
    grid.generateLevel1();
    // lemmings = [];
    var blockCategory = 0x0001;
    var lemmingCategory = 0x0002;
    for (var i = 0; i < 2; i++) {
      setTimeout(function(){
        new Lemming(grid.spawn);
        // console.log(lemming.shape.id);
        // lemmings.push(lemming);
        // console.log(lemmings);
      }, i * 1000);
    };


    // var lemming = new Lemming(grid.spawn);
    //

    Events.on(engine, 'collisionStart', function(event){
      console.log(event);
      var lemming = null;
      if (event.pairs["0"].bodyA.label === "Circle Body"){
        lemming = event.pairs["0"].bodyA;
      } else if (event.pairs["0"].bodyB.label === "Circle Body"){
        lemming = event.pairs["0"].bodyB;
      }
      if (lemming != null){
        if (lemming.velocity.x >= 0) {
          Matter.Body.setVelocity(lemming, { x: 5, y: -0.5 })
        }
        else if (lemming.velocity.x < 0) {
          Matter.Body.setVelocity(lemming, { x: -5, y: -0.5})
        };
      };
    });

    run();


  </script>
</body>
</html>
